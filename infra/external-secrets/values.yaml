# External Secrets Operator production configuration for GKE + Workload Identity

external-secrets:

  # Install CRDs automatically (required for fresh clusters)
  installCRDs: true

  # Core controller configuration
  replicaCount: 1

  image:
    pullPolicy: IfNotPresent

  # Kubernetes ServiceAccount linked to GCP ServiceAccount (CRITICAL)
  serviceAccount:
    create: true
    name: external-secrets
    annotations:
      iam.gke.io/gcp-service-account: secrets-reader@ecommerce-microservice-53.iam.gserviceaccount.com

  # Webhook configuration (required for validation and conversion)
  webhook:
    create: true
    replicaCount: 1
    failurePolicy: Ignore
    port: 9443

  # Certificate controller (generates TLS certs automatically)
  certController:
    create: true
    replicaCount: 1

  # Resource limits (production-safe defaults)
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Pod security context
  podSecurityContext:
    enabled: true
    fsGroup: 65534

  securityContext:
    enabled: true
    runAsNonRoot: true
    runAsUser: 65534

  # Leader election for HA safety
  leaderElect: true

  # Logging
  logLevel: info

  # Metrics (enable if using Prometheus)
  metrics:
    enabled: true
    service:
      enabled: true
      port: 8080

  # Node scheduling (optional but recommended)
  nodeSelector: {}

  tolerations: []

  affinity: {}

# Custom config for your GCP environment (used by your templates)
gcp:
  projectId: ecommerce-microservice-53
  clusterName: ecommerce-platform-prod
  clusterLocation: us-central1
  serviceAccountEmail: secrets-reader@ecommerce-microservice-53.iam.gserviceaccount.com
