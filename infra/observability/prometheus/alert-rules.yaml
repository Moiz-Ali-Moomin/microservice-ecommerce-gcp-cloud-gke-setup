groups:
- name: golden_signals
  rules:
  # 1. Error Rate (Availability/Quality)
  - alert: HighErrorRate
    expr: |
      sum(rate(http_requests_total{status=~"5.."}[5m])) by (service)
      /
      sum(rate(http_requests_total[5m])) by (service) > 0.05
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "High Error Rate (>5%) detected in {{ $labels.service }}"
      description: "{{ $labels.service }} is failing 5% of requests."

  # 2. Latency (Performance)
  - alert: HighLatencyP95
    expr: |
      histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le, service)) > 0.5
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High Latency (P95 > 500ms) in {{ $labels.service }}"

  # 3. Saturation (Resources)
  - alert: HighCpuUsage
    expr: |
      sum(rate(container_cpu_usage_seconds_total[5m])) by (pod) > 0.8
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Pod {{ $labels.pod }} CPU usage > 80%"

  # 4. Availability (Blackbox)
  - alert: EndpointDown
    expr: probe_success == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "Endpoint {{ $labels.instance }} is DOWN"
