# ELITE Production-ready values for bitnami/postgresql

global:
  storageClass: "standard-rwo"

architecture: replication

auth:
  username: "app_user"
  database: "ecommerce_db"
  existingSecret: "postgres-creds"
  # Secret must contain:
  # - postgres-password
  # - password
  # - replication-password

# -------------------
# PRIMARY
# -------------------
primary:
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: "1"
      memory: 2Gi

  persistence:
    enabled: true
    size: 20Gi

  podSecurityContext:
    enabled: true
    fsGroup: 1001

  # HA protection
  podDisruptionBudget:
    enabled: true
    minAvailable: 1

  podAntiAffinityPreset: hard

  extendedConfiguration: |
    max_connections = 300
    shared_buffers = 512MB
    effective_cache_size = 1536MB
    work_mem = 8MB
    maintenance_work_mem = 128MB
    wal_buffers = 16MB
    checkpoint_completion_target = 0.9
    synchronous_commit = on
    log_min_duration_statement = 500
    log_connections = on
    log_disconnections = on

# -------------------
# READ REPLICAS
# -------------------
readReplicas:
  replicaCount: 3 # quorum-safe reads

  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi

  persistence:
    enabled: true
    size: 20Gi

  podDisruptionBudget:
    enabled: true
    minAvailable: 1

  podAntiAffinityPreset: hard

  extendedConfiguration: |
    max_connections = 300
    shared_buffers = 512MB
    effective_cache_size = 1536MB

# -------------------
# SECURITY
# -------------------
networkPolicy:
  enabled: true
  allowExternal: false

# -------------------
# OBSERVABILITY
# -------------------
metrics:
  enabled: false

  serviceMonitor:
    enabled: false
    namespace: platform-observability
    interval: 30s
    scrapeTimeout: 10s
    labels:
      release: prometheus

# -------------------
# BACKUPS (GOAT move)
# -------------------
backup:
  enabled: true
  cronjob:
    schedule: "0 2 * * *" # daily @ 2 AM
    storage:
      size: 10Gi
