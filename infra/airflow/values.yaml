# Airflow Helm Chart Configuration
# Chart: apache-airflow/airflow v1.18.x
# IMPORTANT: Image version MUST match chart version (1.18.x expects Airflow 3.x)

executor: LocalExecutor  # LocalExecutor for resource efficiency (no workers needed)

# Airflow Image - MUST be 3.x for chart 1.18.x
images:
  airflow:
    repository: apache/airflow
    tag: 3.0.2
    pullPolicy: IfNotPresent

# PostgreSQL - Embedded with stable image
postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: bitnami/postgresql
    tag: "16"  # Use major version, not specific point release
  auth:
    enablePostgresUser: true
    postgresPassword: ""  # Auto-generated if empty

# DAGs via GitSync (optional - enable if using git sync)
dags:
  gitSync:
    enabled: false
    # repo: https://github.com/your-org/your-repo.git
    # branch: main
    # subPath: infra/airflow/dags
    # depth: 1

# Logs persistence
logs:
  persistence:
    enabled: true
    size: 10Gi
    storageClassName: standard-rwo  # GKE-compatible

# Disable Helm hooks to prevent migration timeout issues
createUserJob:
  useHelmHooks: false
migrateDatabaseJob:
  useHelmHooks: false

# Replicas - Minimal for resource efficiency
scheduler:
  replicas: 1
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: "1"
      memory: 1Gi

webserver:
  replicas: 1
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: "1"
      memory: 1Gi

# Disable workers (LocalExecutor doesn't need them)
workers:
  replicas: 0

# Disable optional components to save resources
triggerer:
  replicas: 0
dagProcessor:
  replicas: 0
flower:
  enabled: false

# RBAC
rbac:
  create: true

serviceAccount:
  create: true
  name: airflow-service-account
