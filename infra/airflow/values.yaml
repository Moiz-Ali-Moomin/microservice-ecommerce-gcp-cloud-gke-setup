# Airflow Helm Chart Configuration
# Chart: apache-airflow/airflow v1.18.x

executor: LocalExecutor

images:
  airflow:
    repository: us-central1-docker.pkg.dev/ecommerce-microservice-53/ecommerce-repo/airflow
    tag: latest
    pullPolicy: Always

# FIXED PostgreSQL image tag
postgresql:
  enabled: true

  image:
    registry: docker.io
    repository: bitnami/postgresql
    tag: 16.4.0-debian-12-r0   # âœ… VALID tag

  auth:
    enablePostgresUser: true
    postgresPassword: airflow
    username: airflow
    password: airflow
    database: airflow

  primary:
    persistence:
      enabled: true
      size: 10Gi
      storageClass: standard-rwo


# DAGs local mount
dags:
  persistence:
    enabled: true
    size: 1Gi
    storageClassName: standard-rwo


# Logs persistence
logs:
  persistence:
    enabled: true
    size: 10Gi
    storageClassName: standard-rwo


# Disable hooks (prevents timeout)
createUserJob:
  useHelmHooks: false

migrateDatabaseJob:
  useHelmHooks: false


scheduler:
  replicas: 1
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: "1"
      memory: 1Gi


webserver:
  replicas: 1
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: "1"
      memory: 1Gi


workers:
  replicas: 0


triggerer:
  replicas: 0

dagProcessor:
  replicas: 0

flower:
  enabled: false


rbac:
  create: true


serviceAccount:
  create: true
  name: airflow-service-account
